# 数据库配置说明

## 概述

本项目支持两种数据库模式：
1. **模拟数据库模式**：用于开发和测试，无需配置真实数据库
2. **MySQL数据库模式**：用于生产环境，需要配置阿里云MySQL数据库

## 模拟数据库模式

当系统无法连接到MySQL数据库时，会自动切换到模拟数据库模式。

### 特点
- 数据存储在内存中，重启后数据会重置
- 包含预设的测试数据（用户、分类、网站、设置）
- 默认管理员账号：`admin` / `123456`
- 支持所有API功能，适合开发和演示

### 测试数据
- **用户**：1个管理员用户
- **分类**：4个分类（常用工具、开发工具、设计资源、学习资源）
- **网站**：4个示例网站
- **设置**：5个系统设置项

## MySQL数据库模式

### 阿里云MySQL配置步骤

#### 1. 创建阿里云RDS MySQL实例
1. 登录阿里云控制台
2. 进入RDS管理控制台
3. 创建MySQL实例（推荐版本：MySQL 8.0）
4. 配置实例规格和存储空间
5. 设置数据库账号和密码

#### 2. 配置网络和安全组
1. 设置白名单，允许你的服务器IP访问
2. 如果是本地开发，添加你的公网IP到白名单
3. 确保3306端口开放

#### 3. 创建数据库
```sql
CREATE DATABASE navigation_admin CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### 4. 配置环境变量
复制 `.env.example` 文件为 `.env`，并填入你的数据库信息：

```bash
cp .env.example .env
```

编辑 `.env` 文件：
```env
# 数据库配置
DB_HOST=your-rds-instance.mysql.rds.aliyuncs.com
DB_PORT=3306
DB_USER=your-username
DB_PASSWORD=your-password
DB_NAME=navigation_admin

# JWT密钥（请使用强密码）
JWT_SECRET=your-super-secret-jwt-key-here

# 其他配置...
```

#### 5. 初始化数据库表
启动服务器时，系统会自动创建所需的数据表：
- users（用户表）
- categories（分类表）
- sites（网站表）
- settings（设置表）
- access_logs（访问日志表）

### 数据库连接测试

启动服务器后，查看控制台输出：
- ✅ 表示MySQL连接成功
- ⚠️ 表示MySQL连接失败，已切换到模拟数据库

## 切换数据库模式

### 从模拟数据库切换到MySQL
1. 配置正确的 `.env` 文件
2. 确保MySQL服务可访问
3. 重启服务器

### 从MySQL切换到模拟数据库
1. 临时重命名或删除 `config/database.js` 文件
2. 或者在 `.env` 中配置错误的数据库信息
3. 重启服务器

## 故障排除

### 常见错误

1. **Access denied for user**
   - 检查用户名和密码是否正确
   - 确认用户有数据库访问权限

2. **Connection timeout**
   - 检查网络连接
   - 确认白名单配置正确
   - 检查防火墙设置

3. **Database does not exist**
   - 确认数据库已创建
   - 检查数据库名称是否正确

### 调试技巧

1. 查看服务器启动日志
2. 使用数据库客户端工具测试连接
3. 检查阿里云RDS控制台的连接信息

## 生产环境建议

1. 使用强密码和复杂的JWT密钥
2. 定期备份数据库
3. 监控数据库性能和连接数
4. 配置SSL连接（推荐）
5. 设置合适的连接池大小

## 数据迁移

如果需要从模拟数据库迁移到MySQL：
1. 导出模拟数据库中的数据
2. 在MySQL中创建相应的数据
3. 或者使用提供的初始化脚本

## 支持

如果遇到数据库配置问题，请检查：
1. 网络连接
2. 配置文件格式
3. 数据库权限
4. 服务器日志