# =============================
# 静态路径映射（主域：guluwater.com）
# 此文件由 00_guluwater.com.conf 通过 include 引用
# 使用 ^~ 修饰符是为了防止被主配置中的正则 location（如 .html, .js, .css）抢占匹配
# 使用 sub_filter 动态修复静态资源路径（解决 Base URL 不匹配问题）
# =============================

# VitePress 博客
location ^~ /vitepress {
    root /home;
    index index.html;
    try_files $uri $uri/ /vitepress/index.html;
    
    # 动态修复资源路径：将 /assets/ 替换为 /vitepress/assets/
    sub_filter 'href="/assets/' 'href="/vitepress/assets/';
    sub_filter 'src="/assets/' 'src="/vitepress/assets/';
    sub_filter 'href="/' 'href="/vitepress/'; # 修复其他根路径引用
    sub_filter 'src="/' 'src="/vitepress/';   # 修复其他根路径引用
    sub_filter_once off;                      # 全局替换
    sub_filter_types text/html;               # 仅替换 HTML 文件
}

# Office Tools
location ^~ /officetools {
    root /home;
    index index.html;
    try_files $uri $uri/ /officetools/index.html;

    sub_filter 'href="/assets/' 'href="/officetools/assets/';
    sub_filter 'src="/assets/' 'src="/officetools/assets/';
    sub_filter 'href="/' 'href="/officetools/';
    sub_filter 'src="/' 'src="/officetools/';
    sub_filter_once off;
    sub_filter_types text/html;
}

# General Methods Utils
location ^~ /generalmethodsutils {
    root /home;
    index index.html;
    try_files $uri $uri/ /generalmethodsutils/index.html;

    sub_filter 'href="/assets/' 'href="/generalmethodsutils/assets/';
    sub_filter 'src="/assets/' 'src="/generalmethodsutils/assets/';
    sub_filter 'href="/' 'href="/generalmethodsutils/';
    sub_filter 'src="/' 'src="/generalmethodsutils/';
    sub_filter_once off;
    sub_filter_types text/html;
}

# Online Interface Lite
location ^~ /onlineinterfacelite {
    alias /home/onlineinterface/onlineInterfacelite/;
    index index.html;
    try_files $uri $uri/ /onlineinterfacelite/index.html;

    sub_filter 'href="/assets/' 'href="/onlineinterfacelite/assets/';
    sub_filter 'src="/assets/' 'src="/onlineinterfacelite/assets/';
    sub_filter 'href="/' 'href="/onlineinterfacelite/';
    sub_filter 'src="/' 'src="/onlineinterfacelite/';
    sub_filter_once off;
    sub_filter_types text/html;
}

# Online Interface Full
location ^~ /onlineinterfacefull {
    alias /home/onlineinterface/onlineInterfacefull/;
    index index.html;
    try_files $uri $uri/ /onlineinterfacefull/index.html;

    sub_filter 'href="/assets/' 'href="/onlineinterfacefull/assets/';
    sub_filter 'src="/assets/' 'src="/onlineinterfacefull/assets/';
    sub_filter 'href="/' 'href="/onlineinterfacefull/';
    sub_filter 'src="/' 'src="/onlineinterfacefull/';
    sub_filter_once off;
    sub_filter_types text/html;
}

# Online Interface Pro
location ^~ /onlineinterfacepro {
    alias /home/onlineinterface/onlineInterfacepro/;
    index index.html;
    try_files $uri $uri/ /onlineinterfacepro/index.html;

    sub_filter 'href="/assets/' 'href="/onlineinterfacepro/assets/';
    sub_filter 'src="/assets/' 'src="/onlineinterfacepro/assets/';
    sub_filter 'href="/' 'href="/onlineinterfacepro/';
    sub_filter 'src="/' 'src="/onlineinterfacepro/';
    sub_filter_once off;
    sub_filter_types text/html;
}

# Lite Image Previewer
location ^~ /liteimagepreviewer {
    root /home;
    index index.html;
    try_files $uri $uri/ /liteimagepreviewer/index.html;

    sub_filter 'href="/assets/' 'href="/liteimagepreviewer/assets/';
    sub_filter 'src="/assets/' 'src="/liteimagepreviewer/assets/';
    sub_filter 'href="/' 'href="/liteimagepreviewer/';
    sub_filter 'src="/' 'src="/liteimagepreviewer/';
    sub_filter_once off;
    sub_filter_types text/html;
}

# Papercraft
location ^~ /papercraft {
    root /home;
    index index.html;
    try_files $uri $uri/ /papercraft/index.html;

    sub_filter 'href="/assets/' 'href="/papercraft/assets/';
    sub_filter 'src="/assets/' 'src="/papercraft/assets/';
    sub_filter 'href="/' 'href="/papercraft/';
    sub_filter 'src="/' 'src="/papercraft/';
    sub_filter_once off;
    sub_filter_types text/html;
}

# Mock Data Generator
location ^~ /mockdatagenerator {
    alias /home/mockdatagenerator/frontend/;
    index index.html;
    try_files $uri $uri/ /mockdatagenerator/index.html;

    sub_filter 'href="/assets/' 'href="/mockdatagenerator/assets/';
    sub_filter 'src="/assets/' 'src="/mockdatagenerator/assets/';
    sub_filter 'href="/' 'href="/mockdatagenerator/';
    sub_filter 'src="/' 'src="/mockdatagenerator/';
    sub_filter_once off;
    sub_filter_types text/html;
}
